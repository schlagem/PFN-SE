# import pygame
# import math
# import numpy as np
import torch.nn as nn
import torch
import matplotlib.pyplot as plt
import numpy as np


def power_transform(y, lb):
    if y >= 0 and lb != 0:
        return ((y + 1) ** lb - 1) / lb
    elif y >= 0 and lb == 0:
        return np.log(y + 1)
    elif y < 0 and lb != 2:
        return -((-y + 1) ** (2 - lb) - 1) / (2 - lb)
    elif y < 0 and lb == 2:
        return -np.log(-y + 1)
    else:
        raise NotImplementedError(f"No function for y = {y} and lambda {lb}!")


"""
pygame.init()

screen = pygame.display.set_mode((500, 500))

clock = pygame.time.Clock()

rad = 4.7
rad = math.atan2(math.sin(rad), math.cos(rad))
sin = math.sin(rad)
cos = math.cos(rad)
vel = 0.
g = 50.

x = np.random.rand()

while True:
    # Process player inputs.
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            raise SystemExit

    # Do logical updates here.
    # ...

    screen.fill("purple")  # Fill the display with a solid color

    # Render the graphics here.
    # ...
    keys = pygame.key.get_pressed()
    if keys[pygame.K_LEFT]:
        vel = vel + .5 * 0.1
    elif keys[pygame.K_RIGHT]:
        vel = vel - (.5 * 0.1)

    # vel -= g * math.cos(rad) * 0.01
    vel *= 0.99
    max_vel = 7
    if vel > max_vel:
        vel = max_vel

    if vel < -max_vel:
        vel = -max_vel

    rad += vel * 0.1
    print("----")
    print(math.cos(math.atan2(math.sin(rad), math.cos(rad))))
    print(math.sin(math.atan2(math.sin(rad), math.cos(rad))))
    print(math.atan2(math.sin(rad), math.cos(rad)))

    x = math.cos(rad)_
    y = math.sin(rad)
    print("x:", x)
    print("y:", y)
    pygame.draw.line(screen, "green", (250, 250), (250 + 100 * x, 250 - 100 * y), 5)
    max_vel = 7.
    if vel > max_vel:
        vel = max_vel

    if vel < -max_vel:
        vel = -max_vel


    x += vel * 0.1

    max_pos = 1.
    if x > max_pos:
        x = max_pos
        vel = -.7 * vel

    min_pos = 0.
    if x < min_pos:
        x = min_pos
        vel = -.7 * vel

    print(vel)

    pygame.draw.rect(screen, "green", pygame.Rect(225, 450 - x * 450, 50, 50))
    pygame.display.flip()  # Refresh on-screen display
    clock.tick(30)         # wait until next frame (at 60 FPS)
"""
if __name__ == '__main__':
    vals = np.arange(-10000., 10000, 10.)
    lbs = np.arange(-5, 5, 1)
    plt.ylim([10., -10.])
    for l in lbs:
        y = []
        for v in vals:
            y.append(power_transform(v, l))
        plt.plot(vals, y, label=f"lamda = {l}")
    plt.legend()
    plt.show()

a = {"CartPole-v1": {"1.0": {"loss": 0.0003460529842413962, "loss_std": 0.001103592454455793,
                             "axis_loss": [7.400694448733702e-05, 0.001965330448001623, 2.259213215438649e-05,
                                           0.002782812574878335, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                             "axis_loss_std": [0.00046541279880329967, 0.011210722848773003, 4.246842581778765e-05,
                                               0.006337305530905724, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                             "context_loss": [0.0003506993525661528, 0.00033545854967087507, 0.0003531745751388371,
                                              0.0003614957968238741, 0.0004084542451892048, 0.0003134597500320524,
                                              0.0002971753419842571, 0.000348506320733577],
                             "context_loss_std": [0.0009653579909354448, 0.0010118111968040466, 0.0012389676412567496,
                                                  0.0014949560863897204, 0.001418024767190218, 0.0011134437518194318,
                                                  0.00109458202496171, 0.00112101377453655],
                             "std_between_context": 3.332589767524041e-05},
                     "0.5": {"loss": 0.003689404809847474, "loss_std": 0.006256632972508669,
                             "axis_loss": [0.005819355137646198, 0.023890258744359016, 0.00045484930160455406,
                                           0.021487202495336533, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                             "axis_loss_std": [0.01830665022134781, 0.0482405386865139, 0.0009110762621276081,
                                               0.035673629492521286, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                             "context_loss": [0.005250061862170696, 0.002970276167616248, 0.0031197897624224424,
                                              0.005077315028756857, 0.004072572570294142, 0.004470569081604481,
                                              0.0024420723784714937, 0.0021125786006450653],
                             "context_loss_std": [0.010086755268275738, 0.0056442213244736195, 0.005479186307638884,
                                                  0.0091162770986557, 0.007339507341384888, 0.008202643133699894,
                                                  0.004576920531690121, 0.0033482639119029045],
                             "std_between_context": 0.0011953962966799736},
                     "0.0": {"loss": 0.0026991371996700764, "loss_std": 0.001778575242497027,
                             "axis_loss": [0.0028362637385725975, 0.022210627794265747, 0.0008187206694856286,
                                           0.01192230824381113, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                             "axis_loss_std": [0.0016557433409616351, 0.015359709039330482, 0.00044318189611658454,
                                               0.009530982933938503, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                             "context_loss": [0.004774610046297312, 0.001297947601415217, 0.001788390101864934,
                                              0.003041020827367902, 0.0039516412653028965, 0.003583325771614909,
                                              0.0014794198796153069, 0.0016767422202974558],
                             "context_loss_std": [0.004567374009639025, 0.0010305049363523722, 0.0010115011828020215,
                                                  0.002754713175818324, 0.0019855601713061333, 0.0021908043418079615,
                                                  0.0010046320967376232, 0.0009434943785890937],
                             "std_between_context": 0.0013147961581125855}}, "Pendulum-v1": {
    "1.0": {"loss": 0.024099424481391907, "loss_std": 0.02813575603067875,
            "axis_loss": [0.002915378427132964, 0.0018235368188470602, 0.02965352311730385, 0.0, 0.0, 0.0, 0.0, 0.0,
                          0.0, 0.0, 0.0, 0.0, 0.0, 0.3029995262622833],
            "axis_loss_std": [0.005604983307421207, 0.0034662673715502024, 0.03790774941444397, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.3727382719516754],
            "context_loss": [0.020761743187904358, 0.010964023880660534, 0.010732687078416348, 0.046379219740629196,
                             0.026021262630820274, 0.013447345234453678, 0.01654868572950363, 0.04794042930006981],
            "context_loss_std": [0.042070914059877396, 0.018362784758210182, 0.018556423485279083, 0.07795021682977676,
                                 0.03306968882679939, 0.026576876640319824, 0.02354537509381771, 0.08154958486557007],
            "std_between_context": 0.015124744735658169},
    "0.5": {"loss": 0.044117096811532974, "loss_std": 0.06037186458706856,
            "axis_loss": [0.010832852683961391, 0.004952058661729097, 0.06450442969799042, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                          0.0, 0.0, 0.0, 0.0, 0.5373499989509583],
            "axis_loss_std": [0.009952077642083168, 0.0050708525814116, 0.0667814388871193, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.8148304224014282],
            "context_loss": [0.04816775768995285, 0.01206551305949688, 0.01091002207249403, 0.10232774913311005,
                             0.021357204765081406, 0.01712838187813759, 0.012150655500590801, 0.1288294643163681],
            "context_loss_std": [0.08068829029798508, 0.030702413991093636, 0.031610727310180664, 0.1607912927865982,
                                 0.03510303795337677, 0.04261085391044617, 0.0224339310079813, 0.15770789980888367],
            "std_between_context": 0.04625912010669708},
    "0.0": {"loss": 0.014967902563512325, "loss_std": 0.03253457322716713,
            "axis_loss": [0.020419403910636902, 0.004054720047861338, 0.025524405762553215, 0.0, 0.0, 0.0, 0.0, 0.0,
                          0.0, 0.0, 0.0, 0.0, 0.0, 0.15955208241939545],
            "axis_loss_std": [0.007871613837778568, 0.0015899118734523654, 0.04748943820595741, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.0, 0.0, 0.0, 0.0, 0.0, 0.43042415380477905],
            "context_loss": [0.019338496029376984, 0.0043702335096895695, 0.005555135663598776, 0.02581564523279667,
                             0.008413725532591343, 0.005511322058737278, 0.004701002035290003, 0.04603765159845352],
            "context_loss_std": [0.04327841103076935, 0.012334558181464672, 0.010086854919791222, 0.08520083129405975,
                                 0.02215227112174034, 0.015009564347565174, 0.01707352325320244, 0.09205931425094604],
            "std_between_context": 0.014836292713880539}}, "SimpleEnv": {
    "1.0": {"loss": 0.16715845465660095, "loss_std": 0.21765904128551483,
            "axis_loss": [0.6501745581626892, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                          1.6900439262390137],
            "axis_loss_std": [1.2986501455307007, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              2.671724557876587],
            "context_loss": [0.16781781613826752, 0.15405958890914917, 0.20762968063354492, 0.17663009464740753,
                             0.16322368383407593, 0.1577751785516739, 0.15418000519275665, 0.15595166385173798],
            "context_loss_std": [0.22578810155391693, 0.20700740814208984, 0.31248071789741516, 0.25796210765838623,
                                 0.22016079723834991, 0.2054980844259262, 0.2012333869934082, 0.21629321575164795],
            "std_between_context": 0.018115533515810966},
    "0.5": {"loss": 0.2017946094274521, "loss_std": 0.14338739216327667,
            "axis_loss": [0.1940474510192871, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                          2.631077289581299],
            "axis_loss_std": [0.4602014422416687, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              1.9992804527282715],
            "context_loss": [0.20622648298740387, 0.15800519287586212, 0.22251397371292114, 0.21272848546504974,
                             0.2112853080034256, 0.23165562748908997, 0.19198957085609436, 0.17995241284370422],
            "context_loss_std": [0.1544354259967804, 0.11645296216011047, 0.19997885823249817, 0.1626625508069992,
                                 0.15444476902484894, 0.17452704906463623, 0.13715103268623352, 0.13324783742427826],
            "std_between_context": 0.02402668260037899},
    "0.0": {"loss": 0.28410977125167847, "loss_std": 0.02022775635123253,
            "axis_loss": [0.11845593899488449, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                          3.8590807914733887],
            "axis_loss_std": [0.027964560315012932, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                              0.27398258447647095],
            "context_loss": [0.2996567487716675, 0.19781619310379028, 0.24105215072631836, 0.3488894999027252,
                             0.32433441281318665, 0.3626479208469391, 0.2499731332063675, 0.24850799143314362],
            "context_loss_std": [0.022612785920500755, 0.021074682474136353, 0.04409638047218323, 0.018917234614491463,
                                 0.0257929228246212, 0.020869556814432144, 0.024095062166452408, 0.022830195724964142],
            "std_between_context": 0.058502405881881714}}, "Reacher-v4": {
    "1.0": {"loss": 0.5290814638137817, "loss_std": 0.9213010668754578,
            "axis_loss": [0.0139769297093153, 0.014040294103324413, 0.01173318549990654, 0.017934704199433327,
                          0.00027159778983332217, 0.0002869240415748209, 3.381751298904419, 3.9333338737487793,
                          0.0005705470102839172, 0.0005133679951541126, 0.0, 0.0, 0.0, 0.03272853419184685],
            "axis_loss_std": [0.016340449452400208, 0.018311167135834694, 0.014912878163158894, 0.01821002922952175,
                              0.00031468947418034077, 0.0002925470471382141, 4.400590896606445, 11.347572326660156,
                              0.0007939436472952366, 0.0007349541992880404, 0.0, 0.0, 0.0, 0.04350452497601509],
            "context_loss": [0.5195701122283936, 0.5508360862731934, 0.48216912150382996, 0.4631008803844452,
                             0.5115369558334351, 0.6559252738952637, 0.5525438189506531, 0.4969698488712311],
            "context_loss_std": [1.041894793510437, 0.9739219546318054, 0.9589096903800964, 0.8697007298469543,
                                 1.001787781715393, 1.1322234869003296, 1.156074047088623, 0.9748669862747192],
            "std_between_context": 0.0598769374191761},
    "0.5": {"loss": 0.2406180500984192, "loss_std": 0.36103010177612305,
            "axis_loss": [0.010748469270765781, 0.009149602614343166, 0.007742824964225292, 0.01673918217420578,
                          0.0002159566938644275, 0.000262233370449394, 1.6204956769943237, 1.6791815757751465,
                          0.00043137973989360034, 0.0003519706951919943, 0.0, 0.0, 0.0, 0.023333992809057236],
            "axis_loss_std": [0.012682887725532055, 0.01121094636619091, 0.006689454894512892, 0.01379038393497467,
                              0.00022274343064054847, 0.00026553531643003225, 1.5396196842193604, 4.580974102020264,
                              0.0005491033662110567, 0.00032146371086128056, 0.0, 0.0, 0.0, 0.025445738807320595],
            "context_loss": [0.23621194064617157, 0.24483637511730194, 0.2133999764919281, 0.25085192918777466,
                             0.22203466296195984, 0.2930987477302551, 0.2566593289375305, 0.20785151422023773],
            "context_loss_std": [0.397678017616272, 0.4356314241886139, 0.4030183255672455, 0.40170806646347046,
                                 0.3710220158100128, 0.46259987354278564, 0.3875710070133209, 0.43438950181007385],
            "std_between_context": 0.027550727128982544},
    "0.0": {"loss": 0.1311524510383606, "loss_std": 0.07323908805847168,
            "axis_loss": [0.010423730127513409, 0.007352108601480722, 0.008316962979733944, 0.023076131939888,
                          0.00027686089742928743, 0.0003278952499385923, 1.1971038579940796, 0.556382954120636,
                          0.00033916515531018376, 0.00028141672373749316, 0.0, 0.0, 0.0, 0.03225332126021385],
            "axis_loss_std": [0.010426979511976242, 0.008349306881427765, 0.005513343960046768, 0.014046561904251575,
                              0.00026415070169605315, 0.0002957164542749524, 0.7492188811302185, 0.4872186481952667,
                              0.00037197594065219164, 0.00018648826517164707, 0.0, 0.0, 0.0, 0.022289922460913658],
            "context_loss": [0.09779107570648193, 0.11799417436122894, 0.08415431529283524, 0.1728670448064804,
                             0.1296485960483551, 0.1408168375492096, 0.2091773897409439, 0.096770279109478],
            "context_loss_std": [0.11769571155309677, 0.10651709139347076, 0.09792352467775345, 0.1680644154548645,
                                 0.1273908168077469, 0.1412610113620758, 0.19266720116138458, 0.0756373479962349],
            "std_between_context": 0.042427655309438705}}}
